<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Aggregate Functions &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=601dbdee" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Window functions" href="window.html" />
    <link rel="prev" title="JSON Functions" href="json.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="window.html" title="Window functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="json.html" title="JSON Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../spark_functions.html" accesskey="U">Spark Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aggregate Functions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="aggregate-functions">
<h1>Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Link to this heading">¶</a></h1>
<p>Aggregate functions operate on a set of values to compute a single result.</p>
<section id="general-aggregate-functions">
<h2>General Aggregate Functions<a class="headerlink" href="#general-aggregate-functions" title="Link to this heading">¶</a></h2>
<dl class="spark function">
<dt class="sig sig-object spark" id="avg">
<span class="sig-name descname"><span class="pre">avg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">decimal</span></span></span><a class="headerlink" href="#avg" title="Link to this definition">¶</a></dt>
<dd><p>Returns the average (arithmetic mean) of all non-null input values.
When x is of type DECIMAL, the result type is DECIMAL,
and the intermediate results are varbinarys or (sum, count) pairs represented as row(decimal, bigint).
For all other input types, the result type is DOUBLE,
and the intermediate results are (sum, count) pairs represented as row(double, bigint).
When all inputs are nulls, the intermediate result is row(0, 0),
and the final result is null.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="bit_xor">
<span class="sig-name descname"><span class="pre">bit_xor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#bit_xor" title="Link to this definition">¶</a></dt>
<dd><p>Returns the bitwise XOR of all non-null input values, or null if none.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="bloom_filter_agg">
<span class="sig-name descname"><span class="pre">bloom_filter_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hash</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">estimatedNumItems</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">numBits</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">varbinary</span></span></span><a class="headerlink" href="#bloom_filter_agg" title="Link to this definition">¶</a></dt>
<dd><p>Creates bloom filter from input hashes and returns it serialized into VARBINARY.
The caller is expected to apply xxhash64 function to input data before calling bloom_filter_agg.</p>
<dl class="simple">
<dt>For example,</dt><dd><p>bloom_filter_agg(xxhash64(x), 100, 1024)</p>
</dd>
</dl>
<p>In Spark implementation, <code class="docutils literal notranslate"><span class="pre">estimatedNumItems</span></code> and <code class="docutils literal notranslate"><span class="pre">numBits</span></code> are used to decide the number of hash functions and bloom filter capacity.
In Velox implementation, <code class="docutils literal notranslate"><span class="pre">estimatedNumItems</span></code> is not used.</p>
<p><code class="docutils literal notranslate"><span class="pre">hash</span></code> cannot be null.
<code class="docutils literal notranslate"><span class="pre">numBits</span></code> specifies max capacity of the bloom filter, which allows to trade accuracy for memory.
In Spark, the value of <code class="docutils literal notranslate"><span class="pre">numBits</span></code> is automatically capped at config value 67,108,864.
In Velox, the value of <code class="docutils literal notranslate"><span class="pre">numBits</span></code> is automatically capped at the value of spark.bloom_filter.max_num_bits configuration property.</p>
<p><code class="docutils literal notranslate"><span class="pre">hash</span></code>, <code class="docutils literal notranslate"><span class="pre">estimatedNumItems</span></code> and <code class="docutils literal notranslate"><span class="pre">numBits</span></code> must be <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="id0">
<span class="sig-name descname"><span class="pre">bloom_filter_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hash</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">estimatedNumItems</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">varbinary</span></span></span><a class="headerlink" href="#id0" title="Link to this definition">¶</a></dt>
<dd><p>A version of <code class="docutils literal notranslate"><span class="pre">bloom_filter_agg</span></code> that uses <code class="docutils literal notranslate"><span class="pre">numBits</span></code> computed as <code class="docutils literal notranslate"><span class="pre">estimatedNumItems</span></code> * 8.</p>
<p><code class="docutils literal notranslate"><span class="pre">hash</span></code> cannot be null.
<code class="docutils literal notranslate"><span class="pre">estimatedNumItems</span></code> provides an estimate of the number of values of <code class="docutils literal notranslate"><span class="pre">x</span></code> under the fact of <code class="docutils literal notranslate"><span class="pre">hash</span></code> is xxhash64(x).
Value of <code class="docutils literal notranslate"><span class="pre">estimatedNumItems</span></code> is capped at 4,000,000 like to match Spark’s implementation.
But Spark allows for changing the defaults while Velox does not.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="id1">
<span class="sig-name descname"><span class="pre">bloom_filter_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hash</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">varbinary</span></span></span><a class="headerlink" href="#id1" title="Link to this definition">¶</a></dt>
<dd><p>A version of <code class="docutils literal notranslate"><span class="pre">bloom_filter_agg</span></code> that use the value of spark.bloom_filter.max_num_bits configuration property as <code class="docutils literal notranslate"><span class="pre">numBits</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">hash</span></code> cannot be null.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="first">
<span class="sig-name descname"><span class="pre">first</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">x</span></span></span><a class="headerlink" href="#first" title="Link to this definition">¶</a></dt>
<dd><p>Returns the first value of <cite>x</cite>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="first_ignore_null">
<span class="sig-name descname"><span class="pre">first_ignore_null</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">x</span></span></span><a class="headerlink" href="#first_ignore_null" title="Link to this definition">¶</a></dt>
<dd><p>Returns the first non-null value of <cite>x</cite>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="last">
<span class="sig-name descname"><span class="pre">last</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">x</span></span></span><a class="headerlink" href="#last" title="Link to this definition">¶</a></dt>
<dd><p>Returns the last value of <cite>x</cite>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="last_ignore_null">
<span class="sig-name descname"><span class="pre">last_ignore_null</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">x</span></span></span><a class="headerlink" href="#last_ignore_null" title="Link to this definition">¶</a></dt>
<dd><p>Returns the last non-null value of <cite>x</cite>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="max_by">
<span class="sig-name descname"><span class="pre">max_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#max_by" title="Link to this definition">¶</a></dt>
<dd><p>Returns the value of <cite>x</cite> associated with the maximum value of <cite>y</cite>.
Note: Spark provides a non-strictly comparator which is greater than or equals to.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">max_by</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span>
    <span class="n">VALUES</span>
        <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<p>Returns c</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="min_by">
<span class="sig-name descname"><span class="pre">min_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#min_by" title="Link to this definition">¶</a></dt>
<dd><p>Returns the value of <cite>x</cite> associated with the minimum value of <cite>y</cite>.
Note: Spark provides a non-strictly comparator which is less than or equals to.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">min_by</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span>
    <span class="n">VALUES</span>
        <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<p>Returns b</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="sum">
<span class="sig-name descname"><span class="pre">sum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">double</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">real</span></span></span><a class="headerlink" href="#sum" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sum of <cite>x</cite>.</p>
<p>Supported types are TINYINT, SMALLINT, INTEGER, BIGINT, REAL and DOUBLE.</p>
<p>When x is of type DOUBLE, the result type is DOUBLE.
When x is of type REAL, the result type is REAL.
For all other input types, the result type is BIGINT.</p>
<p>Note: When the sum of BIGINT values exceeds its limit, it cycles to the overflowed value rather than raising an error.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">SUM</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span>
    <span class="n">VALUES</span>
        <span class="p">(</span><span class="mi">9223372036854775807</span><span class="n">L</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="n">L</span><span class="p">)</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
<p>Returns -9223372036854775808</p>
</dd></dl>

</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Aggregate Functions</a><ul>
<li><a class="reference internal" href="#general-aggregate-functions">General Aggregate Functions</a><ul>
<li><a class="reference internal" href="#avg"><code class="docutils literal notranslate"><span class="pre">avg()</span></code></a></li>
<li><a class="reference internal" href="#bit_xor"><code class="docutils literal notranslate"><span class="pre">bit_xor()</span></code></a></li>
<li><a class="reference internal" href="#bloom_filter_agg"><code class="docutils literal notranslate"><span class="pre">bloom_filter_agg()</span></code></a></li>
<li><a class="reference internal" href="#id0"><code class="docutils literal notranslate"><span class="pre">bloom_filter_agg()</span></code></a></li>
<li><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">bloom_filter_agg()</span></code></a></li>
<li><a class="reference internal" href="#first"><code class="docutils literal notranslate"><span class="pre">first()</span></code></a></li>
<li><a class="reference internal" href="#first_ignore_null"><code class="docutils literal notranslate"><span class="pre">first_ignore_null()</span></code></a></li>
<li><a class="reference internal" href="#last"><code class="docutils literal notranslate"><span class="pre">last()</span></code></a></li>
<li><a class="reference internal" href="#last_ignore_null"><code class="docutils literal notranslate"><span class="pre">last_ignore_null()</span></code></a></li>
<li><a class="reference internal" href="#max_by"><code class="docutils literal notranslate"><span class="pre">max_by()</span></code></a></li>
<li><a class="reference internal" href="#min_by"><code class="docutils literal notranslate"><span class="pre">min_by()</span></code></a></li>
<li><a class="reference internal" href="#sum"><code class="docutils literal notranslate"><span class="pre">sum()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="json.html"
                          title="previous chapter">JSON Functions</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="window.html"
                          title="next chapter">Window functions</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/functions/spark/aggregate.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="window.html" title="Window functions"
             >next</a> |</li>
        <li class="right" >
          <a href="json.html" title="JSON Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../spark_functions.html" >Spark Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aggregate Functions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>